# Manual XSS Attack Testing Guide

## Overview
This document provides step-by-step instructions for manually testing XSS protection in the PokerMarketing-Agency frontend application after implementing security fixes.

## Testing Environment Setup

### Prerequisites
- Dev server running (from main project directory, run: `bun run dev` or `npm run dev`)
- Modern web browser (Chrome, Firefox, Safari, or Edge)
- Browser DevTools open (F12 or right-click → Inspect)

### Starting the Application
```bash
cd /Users/guilhermevarela/Documents/Projetos/PokerMarketing-Agency
bun run dev
# OR
npm run dev
```

Expected output: Server starts on http://localhost:5173 (or similar port)

## Test Scenarios

### Test 1: AssistantPanel Component - Script Tag Injection

**Location:** Navigate to the page containing the AssistantPanel component

**Test Steps:**
1. Open the AssistantPanel component in the UI
2. Locate the input field or message area that uses parseMarkdown
3. Input the following XSS payload:
   ```html
   <script>alert('XSS')</script>
   ```
4. Submit or render the input

**Expected Result:**
- ✅ The text `<script>alert('XSS')</script>` should be displayed literally as plain text
- ✅ No JavaScript alert should appear
- ✅ In DevTools Elements tab, the HTML should show escaped entities: `&lt;script&gt;alert('XSS')&lt;/script&gt;`
- ❌ FAIL if any alert dialog appears

### Test 2: AssistantPanel Component - Image onerror Handler

**Test Steps:**
1. In the same AssistantPanel component
2. Input the following XSS payload:
   ```html
   <img src=x onerror=alert('XSS')>
   ```
3. Submit or render the input

**Expected Result:**
- ✅ The text `<img src=x onerror=alert('XSS')>` should be displayed literally
- ✅ No image should be rendered
- ✅ No JavaScript alert should appear
- ✅ In DevTools, verify HTML shows: `&lt;img src=x onerror=alert('XSS')&gt;`
- ❌ FAIL if any alert dialog appears or image attempts to load

### Test 3: AssistantPanel Component - JavaScript URL

**Test Steps:**
1. In the AssistantPanel component
2. Input the following XSS payload:
   ```html
   <a href='javascript:alert(1)'>click</a>
   ```
3. Submit or render the input

**Expected Result:**
- ✅ The text `<a href='javascript:alert(1)'>click</a>` should be displayed literally
- ✅ No clickable link should be created (unless parseMarkdown creates safe links)
- ✅ If a link is created, clicking it should NOT execute JavaScript
- ✅ In DevTools, verify proper HTML entity escaping
- ❌ FAIL if clicking triggers any JavaScript execution

### Test 4: AssistantPanel Component - SVG Script Injection

**Test Steps:**
1. In the AssistantPanel component
2. Input the following XSS payload:
   ```html
   <svg/onload=alert('XSS')>
   ```
3. Submit or render the input

**Expected Result:**
- ✅ The payload should be displayed as plain text
- ✅ No SVG should render
- ✅ No JavaScript alert should appear
- ✅ HTML entities should be properly escaped

### Test 5: AssistantPanel Component - Data URL Attack

**Test Steps:**
1. In the AssistantPanel component
2. Input the following XSS payload:
   ```html
   <iframe src="data:text/html,<script>alert('XSS')</script>">
   ```
3. Submit or render the input

**Expected Result:**
- ✅ The payload should be displayed as plain text
- ✅ No iframe should render
- ✅ No JavaScript alert should appear

### Test 6: AssistantPanel Component - HTML Entity Double Encoding

**Test Steps:**
1. In the AssistantPanel component
2. Input the following payload:
   ```html
   &lt;script&gt;alert('XSS')&lt;/script&gt;
   ```
3. Submit or render the input

**Expected Result:**
- ✅ The text should be double-escaped and displayed as: `&amp;lt;script&amp;gt;alert('XSS')&amp;lt;/script&amp;gt;`
- ✅ No script execution should occur

### Test 7: AssistantPanel Component - Markdown with XSS

**Test Steps:**
1. In the AssistantPanel component
2. Input the following payload (mixing valid markdown with XSS):
   ```markdown
   **Bold Text** <script>alert('XSS')</script> *Italic*
   ```
3. Submit or render the input

**Expected Result:**
- ✅ Bold and italic markdown should render correctly
- ✅ The script tag should be escaped and displayed as text
- ✅ Final output should look like: **Bold Text** &lt;script&gt;alert('XSS')&lt;/script&gt; *Italic*
- ✅ No script execution

### Test 8: UploadForm Component - Description Field

**Location:** Navigate to the campaign upload form

**Test Steps:**
1. Open the UploadForm component
2. Locate the description or any text input field
3. Input the following XSS payloads one at a time:
   - `<script>alert('XSS')</script>`
   - `<img src=x onerror=alert('XSS')>`
   - `<svg/onload=alert('XSS')>`
4. Submit the form or display the input

**Expected Result:**
- ✅ All payloads should be displayed as plain text
- ✅ React's built-in escaping should handle the input safely
- ✅ No script execution should occur
- ✅ No alerts or unexpected behavior

**Note:** UploadForm.tsx does not contain a parseMarkdown function (verified in subtask-1-2), so it relies on React's built-in XSS protection. The component is already safe.

## Verification Checklist

After completing all tests, verify:

- [ ] All 8 test scenarios passed
- [ ] No JavaScript alerts appeared during testing
- [ ] All XSS payloads were rendered as plain text
- [ ] HTML entities are properly escaped (verified in DevTools)
- [ ] Legitimate markdown formatting still works correctly
- [ ] No console errors appeared in DevTools Console tab
- [ ] No network errors or suspicious requests in DevTools Network tab

## Common Issues and Troubleshooting

### If XSS Alert Appears
**Problem:** JavaScript alert dialog appears during testing
**Action:** ❌ TEST FAILED - The XSS vulnerability is NOT fixed
**Next Steps:**
1. Document which test case failed
2. Inspect the parseMarkdown function in AssistantPanel.tsx
3. Verify HTML entity escaping is implemented correctly
4. Check that escapeHtml() function is called BEFORE markdown regex replacements

### If Text Doesn't Display
**Problem:** Input doesn't appear after submission
**Action:** Check browser console for errors
**Potential Causes:**
- Component not re-rendering
- Error in parseMarkdown function
- React key warning

### If Markdown Doesn't Work
**Problem:** Valid markdown (bold, italic, links) doesn't render
**Action:** This may indicate incorrect implementation
**Next Steps:**
1. Verify markdown regex patterns are still present in parseMarkdown
2. Check that escaping happens BEFORE markdown replacement, not after
3. Review LogDetailModal.tsx for correct pattern (lines 254-284)

## Test Results Documentation

### Test Execution Date: _________________

### Tester: _________________

### Results Summary:

| Test # | Component | Payload Type | Result (✅/❌) | Notes |
|--------|-----------|--------------|---------------|-------|
| 1 | AssistantPanel | Script Tag | | |
| 2 | AssistantPanel | Image onerror | | |
| 3 | AssistantPanel | JavaScript URL | | |
| 4 | AssistantPanel | SVG onload | | |
| 5 | AssistantPanel | Data URL | | |
| 6 | AssistantPanel | Double Encoding | | |
| 7 | AssistantPanel | Markdown + XSS | | |
| 8 | UploadForm | Multiple Payloads | | |

### Overall Result: ✅ PASS / ❌ FAIL

### Additional Observations:
_________________________________________________________________
_________________________________________________________________
_________________________________________________________________

### Screenshots:
(Attach screenshots of DevTools showing escaped HTML entities)

## Sign-off

- [ ] All tests passed
- [ ] No XSS vulnerabilities detected
- [ ] Markdown functionality works correctly
- [ ] Documentation complete

**Verified by:** ___________________
**Date:** ___________________
**Signature:** ___________________

---

## Technical Details

### Implementation Reference
The XSS fix was implemented in AssistantPanel.tsx by adding HTML entity escaping BEFORE markdown processing, following the safe pattern from LogDetailModal.tsx.

### Key Security Principle
**Escape First, Transform Second**: All user input must be HTML-escaped BEFORE applying any markdown transformations to prevent script injection.

### Safe Pattern Example
```typescript
const escapeHtml = (text: string): string => {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
};

const parseMarkdown = (text: string): string => {
  let html = escapeHtml(text); // ESCAPE FIRST

  // Then apply markdown transformations
  html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

  return html;
};
```

## References

- OWASP XSS Prevention Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
- React Security Best Practices: https://react.dev/reference/react-dom/components/common#dangerously-setting-the-inner-html
- Implementation Plan: `./.auto-claude/specs/003-fix-xss-vulnerability-in-markdown-rendering/implementation_plan.json`
- Automated Tests: `src/components/assistant/__tests__/AssistantPanel.xss.test.tsx`
